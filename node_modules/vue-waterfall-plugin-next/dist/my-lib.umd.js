(function(h,a){typeof exports=="object"&&typeof module!="undefined"?a(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],a):(h=typeof globalThis!="undefined"?globalThis:h||self,a(h.MyLib={},h.Vue))})(this,function(h,a){"use strict";function X(t){return a.getCurrentScope()?(a.onScopeDispose(t),!0):!1}const R=typeof window!="undefined";function Y(t,e){function n(...r){t(()=>e.apply(this,r),{fn:e,thisArg:this,args:r})}return n}function q(t,e={}){let n,r;return l=>{const i=a.unref(t),s=a.unref(e.maxWait);if(n&&clearTimeout(n),i<=0||s!==void 0&&s<=0)return r&&(clearTimeout(r),r=null),l();s&&!r&&(r=setTimeout(()=>{n&&clearTimeout(n),r=null,l()},s)),n=setTimeout(()=>{r&&clearTimeout(r),r=null,l()},i)}}function Q(t,e=200,n={}){return Y(q(e,n),t)}function J(t){var e;const n=a.unref(t);return(e=n==null?void 0:n.$el)!=null?e:n}const Z=R?window:void 0,A=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},I="__vueuse_ssr_handlers__";A[I]=A[I]||{},A[I];var $=Object.getOwnPropertySymbols,tt=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable,nt=(t,e)=>{var n={};for(var r in t)tt.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&$)for(var r of $(t))e.indexOf(r)<0&&et.call(t,r)&&(n[r]=t[r]);return n};function rt(t,e,n={}){const r=n,{window:o=Z}=r,l=nt(r,["window"]);let i;const s=o&&"ResizeObserver"in o,u=()=>{i&&(i.disconnect(),i=void 0)},c=a.watch(()=>J(t),d=>{u(),s&&o&&d&&(i=new ResizeObserver(e),i.observe(d,l))},{immediate:!0,flush:"post"}),f=()=>{u(),c()};return X(f),{isSupported:s,stop:f}}var L,D;R&&(window==null?void 0:window.navigator)&&((L=window==null?void 0:window.navigator)==null?void 0:L.platform)&&/iP(ad|hone|od)/.test((D=window==null?void 0:window.navigator)==null?void 0:D.platform);const ot=({breakpoints:t,wrapperWidth:e,gutter:n,hasAroundGutter:r,initWidth:o})=>{const l=Object.keys(t).map(f=>Number(f)).sort((f,d)=>f-d);let i=e,s=!1;for(const f of l)if(e<=f){i=f,s=!0;break}if(!s)return o;let u=0;const c=t[i].rowPerView;return r?u=(e-n)/c-n:u=(e-(c-1)*n)/c,Math.floor(u)};function it(t){const e=a.ref(0),n=a.ref(null);rt(n,i=>{const s=i[0],{width:u}=s.contentRect;e.value=u});const r=a.computed(()=>ot({wrapperWidth:e.value,breakpoints:t.breakpoints,gutter:t.gutter,hasAroundGutter:t.hasAroundGutter,initWidth:t.width})),o=a.computed(()=>{const i=t.hasAroundGutter?-t.gutter:t.gutter,s=(e.value+i)/(r.value+t.gutter);return Math.floor(s)}),l=a.computed(()=>{if(t.align==="left")return 0;if(t.align==="center"){const i=t.hasAroundGutter?t.gutter:-t.gutter,s=o.value*(r.value+t.gutter)+i;return(e.value-s)/2}else{const i=t.hasAroundGutter?t.gutter:-t.gutter,s=o.value*(r.value+t.gutter)+i;return e.value-s}});return{waterfallWrapper:n,wrapperWidth:e,colWidth:r,cols:o,offsetX:l}}function C(t,e){return new RegExp(`(^|\\s)${e}(\\s|$)`).test(t.className)}function N(t,e){if(C(t,e))return;const n=t.className.split(/\s+/);n.push(e),t.className=n.join(" ")}const at=document.createElement("div").style,S=(()=>{const t={standard:"transform",webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform"};for(const e in t){const n=t[e];if(at[n]!==void 0)return e}return!1})();function _(t){return S===!1?!1:S==="standard"?t:S+t.charAt(0).toUpperCase()+t.substr(1)}const T=_("transform"),B=_("animation-duration"),j=_("animation-delay"),P=_("transition"),k=_("animation-fill-mode");function st(t,e,n,r,o,l,i){const s=a.ref([]),u=a.ref(0),c=g=>{const m=t.hasAroundGutter?g+1:g;return t.gutter*m+e.value*g+r.value},f=()=>{const g=t.space||t.gutter;s.value=new Array(n.value).fill(t.hasAroundGutter?g:0)},d=ut(t);return{wrapperHeight:u,layoutHandle:async()=>new Promise(g=>{f();const m=[];if(o&&o.value&&o.value.childNodes.forEach(y=>{y.className==="waterfall-item"&&m.push(y)}),m.length===0)return!1;for(let y=0;y<m.length;y++){const E=m[y];let w=lt(s.value,i),K=s.value[w];l&&(w=y%n.value,K=s.value[w]);const $t=c(w),O=E.style;T&&(O[T]=`translate3d(${Math.floor($t)}px,${Math.floor(K)}px, 0)`),O.width=`${e.value}px`,O.visibility="visible";const{height:Lt}=E.getBoundingClientRect(),Dt=t.space||t.gutter;s.value[w]+=Lt+Dt,t.animationCancel||d(E,()=>{const Ct=t.posDuration/1e3;P&&(O[P]=`transform ${Ct}s`)})}u.value=Math.max.apply(null,s.value),setTimeout(()=>{g(!0)},t.posDuration)})}}function lt(t,e){if(t.length===0)return-1;const n=Math.min(...t),r=n+e;let o=-1;for(let l=0;l<t.length;l++)if(t[l]>=n&&t[l]<=r){o=l;break}return o}function ut(t){return(e,n)=>{const r=e.firstChild;if(r&&!C(r,t.animationPrefix)){const o=`${t.animationDuration/1e3}s`,l=`${t.animationDelay/1e3}s`,i=r.style;N(r,t.animationPrefix),N(r,t.animationEffect),B&&(i[B]=o),j&&(i[j]=l),k&&(i[k]="both"),n&&setTimeout(()=>{n()},t.animationDuration+t.animationDelay)}}}const ct=typeof window!="undefined"&&window!==null,V=mt(),ft=Object.prototype.propertyIsEnumerable,W=Object.getOwnPropertySymbols;function dt(t,...e){return e.map(r=>r.replace(/\[(\w+)\]/g,".$1").split(".").reduce((o,l)=>o&&o[l],t))}function mt(){return ct&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype?("isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get(){return this.intersectionRatio>0}}),!0):!1}function p(t){return typeof t=="function"||toString.call(t)==="[object Object]"}function yt(t){return typeof t=="object"?t===null:typeof t!="function"}function ht(t){return t!=="__proto__"&&t!=="constructor"&&t!=="prototype"}function gt(t,...e){if(!p(t))throw new TypeError("expected the first argument to be an object");if(e.length===0||typeof Symbol!="function"||typeof W!="function")return t;for(const n of e){const r=W(n);for(const o of r)ft.call(n,o)&&(t[o]=n[o])}return t}function M(t,...e){let n=0;for(yt(t)&&(t=e[n++]),t||(t={});n<e.length;n++)if(p(e[n])){for(const r of Object.keys(e[n]))ht(r)&&(p(t[r])&&p(e[n][r])?M(t[r],e[n][r]):t[r]=e[n][r]);gt(t,e[n])}return t}function x(t,e){return new Promise((n,r)=>{const o=new Image;o.onload=()=>{n(o)},o.onerror=()=>{r(new Error("Image load error"))},e&&(o.crossOrigin="Anonymous"),o.src=t})}var b;(function(t){t.LOADING="loading",t.LOADED="loaded",t.ERROR="error"})(b||(b={}));const bt={rootMargin:"0px",threshold:0},G="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",_t="";class pt{constructor(e=!0,n,r=!0){this.lazyActive=!0,this.crossOrigin=!0,this.options={loading:G,error:_t,observerOptions:bt,log:!0,ratioCalculator:(o,l)=>l/o},this._images=new WeakMap,this.lazyActive=e,this.crossOrigin=r,this.config(n)}config(e={}){M(this.options,e),e.ratioCalculator&&(this.options.ratioCalculator=e.ratioCalculator)}mount(e,n,r){const{src:o,loading:l,error:i}=this._valueFormatter(n);e.setAttribute("lazy",b.LOADING),e.setAttribute("src",l||G),this.lazyActive?(V||(this._setImageSrc(e,o,r,i),this._log(()=>{throw new Error("Not support IntersectionObserver!")})),this._initIntersectionObserver(e,o,r,i)):this._setImageSrc(e,o,r,i)}resize(e,n){const r=e.getAttribute("lazy"),o=e.getAttribute("src");r&&r===b.LOADED&&o&&x(o,this.crossOrigin).then(l=>{const{width:i,height:s}=l,u=e.width/i*s;e.height=u;const c=e.style;c.height=`${u}px`,n()})}unmount(e){const n=this._realObserver(e);n&&n.unobserve(e),this._images.delete(e)}_setImageSrc(e,n,r,o){!n||e.getAttribute("src")===n||x(n,this.crossOrigin).then(i=>{var d,v;const{width:s,height:u}=i,c=((v=(d=this.options).ratioCalculator)==null?void 0:v.call(d,s,u))||u/s,f=e.parentNode.parentNode;f.style.paddingBottom=`${c*100}%`,e.setAttribute("lazy",b.LOADED),e.removeAttribute("src"),e.src=i.src,r(!0)}).catch(()=>{const i=this._realObserver(e);i&&i.disconnect(),o&&(e.setAttribute("lazy",b.ERROR),e.setAttribute("src",o),r(!1)),this._log(()=>{throw new Error(`Image failed to load!And failed src was: ${n} `)})})}_isOpenLazy(){return V&&this.lazyActive}_initIntersectionObserver(e,n,r,o){const l=this.options.observerOptions;this._images.set(e,new IntersectionObserver(s=>{Array.prototype.forEach.call(s,u=>{if(u.isIntersecting){const c=this._realObserver(e);c&&c.unobserve(u.target),this._setImageSrc(e,n,r,o)}})},l));const i=this._realObserver(e);i&&i.observe(e)}_valueFormatter(e){let n=e,r=this.options.loading,o=this.options.error;return p(e)&&(n=e.src,r=e.loading||this.options.loading,o=e.error||this.options.error),{src:n,loading:r,error:o}}_log(e){this.options.log&&e()}_realObserver(e){return this._images.get(e)}}var Nt="",F=(t,e)=>{for(const[n,r]of e)t[n]=r;return t};const z=a.defineComponent({props:{list:{type:Array,default:()=>[]},rowKey:{type:String,default:"id"},imgSelector:{type:String,default:"src"},width:{type:Number,default:200},breakpoints:{type:Object,default:()=>({1200:{rowPerView:3},800:{rowPerView:2},500:{rowPerView:1}})},gutter:{type:Number,default:10},space:{type:Number,default:null},hasAroundGutter:{type:Boolean,default:!0},posDuration:{type:Number,default:300},animationPrefix:{type:String,default:"animate__animated"},animationEffect:{type:String,default:"fadeIn"},animationDuration:{type:Number,default:1e3},animationDelay:{type:Number,default:300},animationCancel:{type:Boolean,default:!1},backgroundColor:{type:String,default:"#fff"},lazyload:{type:Boolean,default:!0},loadProps:{type:Object,default:()=>{}},crossOrigin:{type:Boolean,default:!0},delay:{type:Number,default:300},align:{type:String,default:"center"},horizontalOrder:{type:Boolean,default:!1},heightDifference:{type:Number,default:0}},setup(t,e){const n=new pt(t.lazyload,t.loadProps,t.crossOrigin);a.provide("lazy",n);const{waterfallWrapper:r,wrapperWidth:o,colWidth:l,cols:i,offsetX:s}=it(t),{wrapperHeight:u,layoutHandle:c}=st(t,l,i,s,r,t.horizontalOrder,t.heightDifference),f=Q(()=>{c().then(()=>{e.emit("afterRender")})},t.delay);a.watch(()=>[o,l,t.list],()=>{o.value>0&&f()},{deep:!0});const d=a.ref(0);return a.provide("sizeChangeTime",d),a.provide("imgLoaded",f),{colWidth:l,waterfallWrapper:r,wrapperHeight:u,getRenderURL:m=>dt(m,t.imgSelector)[0],getKey:(m,y)=>m[t.rowKey]||y,renderer:f}}}),H=()=>{a.useCssVars(t=>({bacbbe20:t.backgroundColor}))},U=z.setup;z.setup=U?(t,e)=>(H(),U(t,e)):H;const wt=z,vt={class:"waterfall-card"};function Ot(t,e,n,r,o,l){return a.openBlock(),a.createElementBlock("div",{ref:"waterfallWrapper",class:"waterfall-list",style:a.normalizeStyle({height:`${t.wrapperHeight}px`})},[(a.openBlock(!0),a.createElementBlock(a.Fragment,null,a.renderList(t.list,(i,s)=>(a.openBlock(),a.createElementBlock("div",{key:t.getKey(i,s),class:"waterfall-item"},[a.createElementVNode("div",vt,[a.renderSlot(t.$slots,"default",{item:i,index:s,url:t.getRenderURL(i)},void 0,!0),a.renderSlot(t.$slots,"item",{item:i,index:s,url:t.getRenderURL(i)},void 0,!0)])]))),128))],4)}var At=F(wt,[["render",Ot],["__scopeId","data-v-685ac8d0"]]),Tt="";const It=a.defineComponent({props:{url:{type:String,default:""},title:{type:String,default:""},alt:{type:String,default:""},ratio:{type:Number,default:1}},setup(t,e){const n=a.inject("imgLoaded"),r=a.inject("lazy"),o=a.ref(null);a.onMounted(()=>{l()}),a.onUnmounted(()=>{i()}),a.watch(()=>t.url,(u,c)=>{l()});function l(){!o.value||r.mount(o.value,t.url,u=>{n(),u?e.emit("success",t.url):e.emit("error",t.url)})}function i(){!o.value||r.unmount(o.value)}function s(){e.emit("load",t.url)}return{lazyRef:o,imageLoad:s}}}),St={class:"lazy__resource"},zt=["title","alt"];function Et(t,e,n,r,o,l){return a.openBlock(),a.createElementBlock("div",{class:"lazy__box",style:a.normalizeStyle({paddingBottom:`${t.ratio*100}%`})},[a.createElementVNode("div",St,[a.createElementVNode("img",{ref:"lazyRef",class:"lazy__img",title:t.title,alt:t.alt,onLoad:e[0]||(e[0]=(...i)=>t.imageLoad&&t.imageLoad(...i))},null,40,zt)])],4)}var Rt=F(It,[["render",Et],["__scopeId","data-v-06fbfcdb"]]);h.LazyImg=Rt,h.Waterfall=At,Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
