var at=Object.defineProperty;var ut=(l,c,h)=>c in l?at(l,c,{enumerable:!0,configurable:!0,writable:!0,value:h}):l[c]=h;var _=(l,c,h)=>(ut(l,typeof c!="symbol"?c+"":c,h),h);(function(l,c){typeof exports=="object"&&typeof module!="undefined"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(l=typeof globalThis!="undefined"?globalThis:l||self,c(l.MyLib={}))})(this,function(l){"use strict";const c=typeof window!="undefined"&&window!==null,h=P(),N=Object.prototype.propertyIsEnumerable,v=Object.getOwnPropertySymbols;function x(t,...e){return e.map(n=>n.replace(/\[(\w+)\]/g,".$1").split(".").reduce((i,u)=>i&&i[u],t))}function j(t,e){let r=null;return function(){r&&clearTimeout(r),r=null;const n=arguments,i=this;r=setTimeout(()=>{t.call(i,n)},e)}}function P(){return c&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype?("isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get(){return this.intersectionRatio>0}}),!0):!1}function p(t){return typeof t=="function"||toString.call(t)==="[object Object]"}function k(t){return typeof t=="object"?t===null:typeof t!="function"}function M(t){return t!=="__proto__"&&t!=="constructor"&&t!=="prototype"}function B(t,...e){if(!p(t))throw new TypeError("expected the first argument to be an object");if(e.length===0||typeof Symbol!="function"||typeof v!="function")return t;for(const r of e){const n=v(r);for(const i of n)N.call(r,i)&&(t[i]=r[i])}return t}function w(t,...e){let r=0;for(k(t)&&(t=e[r++]),t||(t={});r<e.length;r++)if(p(e[r])){for(const n of Object.keys(e[r]))M(n)&&(p(t[n])&&p(e[r][n])?w(t[n],e[r][n]):t[n]=e[r][n]);B(t,e[r])}return t}function G(t){return new Promise((e,r)=>{const n=new Image;n.onload=()=>{e(n)},n.onerror=()=>{r(new Error("Image load error"))},n.crossOrigin="Anonymous",n.src=t})}const g={LOADING:"loading",LOADED:"loaded",ERROR:"error"},Y={rootMargin:"0px",threshold:0},A="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",F="";class V{constructor(e=!0,r){_(this,"lazyActive",!0);_(this,"options",{loading:A,error:F,observerOptions:Y,log:!0});_(this,"_images",new WeakMap);this.lazyActive=e,this.config(r)}config(e={}){w(this.options,e)}mount(e,r,n){const{src:i,loading:u,error:o}=this._valueFormatter(r);e.setAttribute("lazy",g.LOADING),e.setAttribute("src",u||A),this.lazyActive?(h||(this._setImageSrc(e,i,n,o),this._log(()=>{throw new Error("Not support IntersectionObserver!")})),this._initIntersectionObserver(e,i,n,o)):this._setImageSrc(e,i,n,o)}unmount(e){const r=this._realObserver(e);r&&r.unobserve(e),this._images.delete(e)}_setImageSrc(e,r,n,i){!r||e.getAttribute("src")===r||G(r).then(o=>{const{width:f,height:s}=o,a=s/f,y=e.parentNode.parentNode;y.style.paddingBottom=a*100+"%",e.setAttribute("lazy",g.LOADED),e.removeAttribute("src"),e.setAttribute("src",r),n()}).catch(()=>{const o=this._realObserver(e);o&&o.disconnect(),i&&(e.setAttribute("lazy",g.ERROR),e.setAttribute("src",i)),this._log(()=>{throw new Error(`Image failed to load!And failed src was: ${r} `)}),n()})}_isOpenLazy(){return h&&this.lazyActive}_initIntersectionObserver(e,r,n,i){const u=this.options.observerOptions;this._images.set(e,new IntersectionObserver(f=>{Array.prototype.forEach.call(f,s=>{if(s.isIntersecting){const a=this._realObserver(e);a&&a.unobserve(s.target),this._setImageSrc(e,r,n,i)}})},u));const o=this._realObserver(e);o&&o.observe(e)}_valueFormatter(e){let r=e,n=this.options.loading,i=this.options.error;return p(e)&&(r=e.src,n=e.loading||this.options.loading,i=e.error||this.options.error),{src:r,loading:n,error:i}}_log(e){this.options.log&&e()}_realObserver(e){return this._images.get(e)}}const U=({breakpoints:t,wrapperWidth:e,gutter:r,hasAroundGutter:n,initWidth:i})=>{const u=Object.keys(t).map(a=>Number(a)).sort((a,y)=>a-y);let o=e,f=!1;for(const a of u)if(e<=a){o=a,f=!0;break}if(!f)return i;const s=t[o]?t[o].rowPerView:4;return n?(e-r)/s-r:(e-(s-1)*r)/s};function O(t,e){return new RegExp(`(^|\\s)${e}(\\s|$)`).test(t.className)}function I(t,e){if(O(t,e))return;const r=t.className.split(/\s+/);r.push(e),t.className=r.join(" ")}const X=document.createElement("div").style,b=(()=>{const t={webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform",standard:"transform"};for(const e in t){const r=t[e];if(X[r]!==void 0)return e}return!1})();function m(t){return b===!1?!1:b==="standard"?t:b+t.charAt(0).toUpperCase()+t.substr(1)}var H=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{ref:"waterfallWrapper",staticClass:"waterfall-list",style:t.wrapperStyle},t._l(t.list,function(n,i){return r("div",{key:t.getKey(n,i),ref:"waterfallItem",refInFor:!0,staticClass:"waterfall-item"},[r("div",{staticClass:"waterfall-card"},[t._t("item",null,{item:n,index:i,url:t.getRenderURL(n)})],2)])}),0)},K=[],lt="";function S(t,e,r,n,i,u,o,f){var s=typeof t=="function"?t.options:t;e&&(s.render=e,s.staticRenderFns=r,s._compiled=!0),n&&(s.functional=!0),u&&(s._scopeId="data-v-"+u);var a;if(o?(a=function(d){d=d||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!d&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(d=__VUE_SSR_CONTEXT__),i&&i.call(this,d),d&&d._registeredComponents&&d._registeredComponents.add(o)},s._ssrRegister=a):i&&(a=f?function(){i.call(this,(s.functional?this.parent:this).$root.$options.shadowRoot)}:i),a)if(s.functional){s._injectStyles=a;var y=s.render;s.render=function(ot,D){return a.call(D),y(ot,D)}}else{var T=s.beforeCreate;s.beforeCreate=T?[].concat(T,a):[a]}return{exports:t,options:s}}const z=m("transform"),R=m("animation-duration"),$=m("animation-delay"),E=m("transition"),L=m("animation-fill-mode"),Q={props:{list:{type:Array,default:()=>[]},rowKey:{type:String,default:"id"},imgSelector:{type:String,default:"src"},width:{type:Number,default:200},breakpoints:{type:Object,default:()=>({1200:{rowPerView:3},800:{rowPerView:2},500:{rowPerView:1}})},gutter:{type:Number,default:10},hasAroundGutter:{type:Boolean,default:!0},animationPrefix:{type:String,default:"animate__animated"},animationEffect:{type:String,default:"fadeIn"},animationDuration:{type:Number,default:1e3},animationDelay:{type:Number,default:300},backgroundColor:{type:String,default:"#fff"},lazyload:{type:Boolean,default:!0},loadProps:{type:Object,default:()=>{}},delay:{type:Number,default:300}},data(){return{wrapperWidth:0,wrapperHeight:0,posY:[]}},provide(){return{lazy:new V(this.lazyload,this.loadProps),imgLoaded:this.renderer}},computed:{colWidth(){return U({wrapperWidth:this.wrapperWidth,breakpoints:this.breakpoints,gutter:this.gutter,hasAroundGutter:this.hasAroundGutter,initWidth:this.width})},cols(){const t=this.hasAroundGutter?-this.gutter:this.gutter;return Math.floor((this.wrapperWidth+t)/(this.colWidth+this.gutter))},offsetX(){const t=this.hasAroundGutter?this.gutter:-this.gutter,e=this.cols*(this.colWidth+this.gutter)+t;return(this.wrapperWidth-e)/2},wrapperStyle(){return{height:`${this.wrapperHeight}px`,backgroundColor:this.backgroundColor}}},watch:{colWidth(){this.$nextTick(()=>{this.renderer()})},gutter(){this.$nextTick(()=>{this.renderer()})},wrapperWidth(){this.renderer()},list:{handler:function(){this.$nextTick(()=>{this.renderer()})},deep:!0}},mounted(){this.addWrapperSizeListener()},beforeDestroy(){this.removeWrapperSizeListener()},methods:{renderer:j(function(){this.layoutHandle()},300),layoutHandle(){this.initY();const t=this.$refs.waterfallItem;if(!!t&&t.length!==0){for(let e=0;e<t.length;e++){const r=t[e],n=Math.min.apply(null,this.posY),i=this.posY.indexOf(n),u=this.getX(i),o=r.style;z&&(o[z]=`translate3d(${u}px,${n}px, 0)`),o.width=`${this.colWidth}px`;const{height:f}=r.getBoundingClientRect();this.posY[i]+=f+this.gutter,this.addAnimation(r,()=>{const s=`${this.animationDuration/1e3}s`;E&&(o[E]=`transform ${s}`)})}this.wrapperHeight=Math.max.apply(null,this.posY)}},addWrapperSizeListener(){const t=this.$refs.waterfallWrapper;!t||(this.wrapperObserver=new ResizeObserver(e=>{const{width:r}=(e[0]||{}).contentRect||{};this.wrapperWidth=r}),this.wrapperObserver.observe(t))},removeWrapperSizeListener(){const t=this.$refs.waterfallWrapper;!t||this.wrapperObserver.unobserve(t)},getX(t){const e=this.hasAroundGutter?t+1:t;return this.gutter*e+this.colWidth*t+this.offsetX},initY(){this.posY=new Array(this.cols).fill(this.hasAroundGutter?this.gutter:0)},getRenderURL(t){return x(t,this.imgSelector)[0]},getKey(t,e){return t[this.rowKey]||e},addAnimation(t,e){const r=t.firstChild;if(r&&!O(r,this.animationPrefix)){const n=`${this.animationDuration/1e3}s`,i=`${this.animationDelay/1e3}s`,u=r.style;u.visibility="visible",R&&(u[R]=n),$&&(u[$]=i),L&&(u[L]="both"),I(r,this.animationPrefix),I(r,this.animationEffect),e&&setTimeout(()=>{e()},this.animationDuration+this.animationDelay)}}}},W={};var q=S(Q,H,K,!1,J,"d4d3d714",null,null);function J(t){for(let e in W)this[e]=W[e]}var Z=function(){return q.exports}(),tt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"lazy__box"},[r("div",{staticClass:"lazy__resource"},[r("img",{ref:"lazyRef",staticClass:"lazy__img",attrs:{alt:""}})])])},et=[],ct="";const rt={props:{url:{type:String,default:""}},inject:["lazy","imgLoaded"],mounted(){this.render()},beforeDestroy(){this.unRender()},methods:{render(){const t=this.$refs.lazyRef;!t||this.lazy.mount(t,this.url,()=>{this.imgLoaded()})},unRender(){const t=this.$refs.lazyRef;!t||this.lazy.unmount(t)}}},C={};var nt=S(rt,tt,et,!1,it,"af0d44fe",null,null);function it(t){for(let e in C)this[e]=C[e]}var st=function(){return nt.exports}();l.LazyImg=st,l.Waterfall=Z,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
